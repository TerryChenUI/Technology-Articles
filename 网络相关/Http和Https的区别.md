# Http和Https的区别

## Http
* 在TCP协议中默认使用80端口，以http://开头。
* 使用明文传输内容。

## Https
* Http封装的信息都是明文的，通过抓包工具可以分析其内容，如果这些内容包含有你的银行卡账号，密码，那么你肯定没法接受这种服务，所以需要加密这些敏感的服务，就需要用到Https。
* 在HTTP(应用层) 和TCP(传输层)之间插入一个SSL协议, 就是HTTPS。
* 在TCP协议中默认使用443端口，以https://开头。

**工作流程：**
1. 完成TCP三次同步握手 
2. 客户端验证服务器数字证书，通过，进入步骤3 
3. DH算法协商对称加密算法的密钥、hash算法的密钥 
4. SSL安全加密隧道协商完成 
5. 网页以加密的方式传输，用协商的对称加密算法和密钥加密，保证数据机密性；用协商的hash算法进行数据完整性保护，保证数据不被篡改

**加密流程：**
1. 客户端的浏览器向服务器传送客户端SSL 协议的版本号，加密算法的种类，产生的随机数，以及其他服务器和客户端之间通讯所需要的各种信息。
2. 服务器向客户端传送SSL 协议的版本号，加密算法的种类，随机数以及其他相关信息，同时服务器还将向客户端传送自己的证书。
3. 客户利用服务器传过来的信息验证服务器的合法性，服务器的合法性包括：证书是否过期，发行服务器证书的CA 是否可靠，发行者证书的公钥能否正确解开服务器证书的“发行者的数字签名”，服务器证书上的域名是否和服务器的实际域名相匹配。如果合法性验证没有通过，通讯将断开；如果合法性验证通过，将继续进行第四步。
4. 用户端随机产生一个用于后面通讯的“对称密码”，然后用服务器的公钥（服务器的公钥从步骤②中的服务器的证书中获得）对其加密，然后传给服务器。
5. 服务器用私钥解密“对称密码”(此处的公钥和私钥是相互关联的，公钥加密的数据只能用私钥解密，私钥只在服务器端保留。然后用其作为服务器和客户端的“通话密码”加解密通讯。同时在SSL 通讯过程中还要完成数据通讯的完整性，防止数据通讯中的任何变化。
6. 客户端向服务器端发出信息，指明后面的数据通讯将使用的步骤⑤中的主密码为对称密钥，同时通知服务器客户端的握手过程结束。
7. 服务器向客户端发出信息，指明后面的数据通讯将使用的步骤⑤中的主密码为对称密钥，同时通知客户端服务器端的握手过程结束。
8. SSL 的握手部分结束，SSL 安全通道的数据通讯开始，客户和服务器开始使用相同的对称密钥进行数据通讯，同时进行通讯完整性的检验。

![](http://cdn.wiz.cn/wp-content/uploads/2015/06/wiz_logo.png)

## SSL是如何加密的
SSL采用一种叫做公开密钥加密(Public-key cryptography)的加密方式。
既然是加密，那肯定是不希望别人知道我的消息，所以只有我才能解密，所以可得出公钥负责加密，私钥负责解密；同理，既然是签名，那肯定是不希望有人冒充我发消息，只有我才能发布这个签名，所以可得出私钥负责签名，公钥负责验证。

### hash算法
最早用的hash算法称为MD5，采用128位，但是最近几年已经能够很轻易破解，即通过MD5 hash 能够得到其明文，进而改写明文，再重新对改写的明文重新 Hash，这样的话就起不到保护数据完整性的要求。
现在一般采用SHA这种hash算法，目前还没有报道被破解，应该是安全的。

## 参考
[Http和Https的区别](http://www.jianshu.com/p/37654eb66b58)
[http和https有何区别](https://www.zhihu.com/question/19577317)
[5分钟理解https工作流程](http://www.jianshu.com/p/a68ca86183d7)
[HTTPS证书生成原理和部署细节](http://www.barretlee.com/blog/2015/10/05/how-to-build-a-https-server/)